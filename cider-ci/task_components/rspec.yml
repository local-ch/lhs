ports:
  CAPYBARA_PORT:
    min: 8000
    max: 8999
  PHANTOMJS_PORT:
    min: 44600
    max: 44999

environment_variables:
  RUBY:
    read_and_replace_with: .ruby-version
  BUNDLER:
    read_and_replace_with: .bundler-version

scripts:
  rspec:
    body: |
      #!/usr/bin/env bash
      set -eux
      mkdir -p tmp/cache
      export PATH=~/.rubies/$RUBY/bin:$PATH
      if [ ! -z ${ACTIVESUPPORT:-} ]; then BUNDLE_GEMFILE=Gemfile.activesupport$ACTIVESUPPORT bundle $BUNDLER exec rspec; else bundle exec rspec; fi
    
    start_when:
      'bundled':
        script_key: bundle

trial_attachments:
  logs:
    include_match: log\/.*\.log$
    content_type: text/plain
  image-screenshots:
    include_match: tmp\/capybara\/.*\.png$
    content_type: image/png
  html-screenshots:
    include_match: tmp\/capybara\/.*\.html$
    content_type: text/html
